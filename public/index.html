<!-- index.html ‚úÖ FULL UPDATED (Yordi Coffee frontend) ‚Äî professional UI/UX, smoother scroll, better mobile
     ‚úÖ Keeps your same backend endpoints + JS functions
     ‚úÖ Fixes: duplicate meta/title, improves layout, adds mobile menu, sticky category bar, better cards/modals
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yordi Coffee ‚Äî Online Shopping</title>
  <meta name="description" content="Fresh coffee products ‚Äî beans, ground coffee, espresso, traditional coffee & accessories." />

  <!-- Open Graph (Facebook) -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Yordi Coffee ‚Äî Fresh Coffee Delivered" />
  <meta property="og:description" content="Beans ‚Ä¢ Ground ‚Ä¢ Espresso ‚Ä¢ Traditional ‚Ä¢ Accessories available at Yordi Coffee" />
  <meta property="og:url" content="https://eshetu70.github.io/coffee/public/index.html" />
  <meta property="og:image" content="https://eshetu70.github.io/coffee/public/images/og-coffee.png" />
  <meta property="og:site_name" content="Yordi Coffee" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Yordi Coffee ‚Äî Fresh Coffee Delivered" />
  <meta name="twitter:description" content="Beans ‚Ä¢ Ground ‚Ä¢ Espresso ‚Ä¢ Traditional ‚Ä¢ Accessories" />
  <meta name="twitter:image" content="https://eshetu70.github.io/coffee/public/images/og-coffee.jpg" />

  <style>
    :root{
      --bg:#0b0f14;
      --surface:#0f1620;
      --card:#121b27;
      --card2:#0f1824;
      --text:#eaf0ff;
      --muted:#a9b6d2;
      --muted2:#7f8aa3;
      --border:rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.35);

      --coffee1:#7a4a2f;
      --coffee2:#3a1d16;
      --accent:#d7a36a;
      --accent2:#ffcf8a;

      --good:#35c980;
      --bad:#ff5b5b;
      --warn:#ffb020;

      --radius:18px;
      --radius2:14px;
      --container:1200px;
      --headerH:72px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(215,163,106,.20), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(122,74,47,.25), transparent 60%),
        linear-gradient(180deg, #070a0f 0%, #0b0f14 35%, #0b0f14 100%);
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }
    button, input, textarea, select{ font:inherit; }
    .container{ max-width:var(--container); margin:0 auto; padding:0 18px; }

    /* ---------- HEADER ---------- */
    .header{
      position:sticky; top:0; z-index:1200;
      height:var(--headerH);
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(15,22,32,.85) 0%, rgba(15,22,32,.60) 100%);
      border-bottom:1px solid var(--border);
    }
    .nav{
      height:100%;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:1000; letter-spacing:.2px;
      user-select:none; cursor:pointer;
    }
    .brand-badge{
      width:38px; height:38px; border-radius:12px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(215,163,106,.25), rgba(122,74,47,.25));
      border:1px solid rgba(215,163,106,.25);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
    }
    .brand-title{ display:flex; flex-direction:column; line-height:1.05; }
    .brand-title b{ font-size:15px; }
    .brand-title span{ font-size:12px; color:var(--muted); font-weight:800; }

    .nav-actions{ display:flex; align-items:center; gap:10px; }
    .nav-links{
      display:flex; align-items:center; gap:10px;
    }

    .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(18,27,39,.55);
      cursor:pointer;
      font-weight:950;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .chip:hover{ transform: translateY(-1px); border-color: rgba(215,163,106,.35); background: rgba(18,27,39,.75); }
    .chip small{ color:var(--muted); font-weight:900; }

    .count{
      width:22px; height:22px; border-radius:999px;
      display:grid; place-items:center;
      background: var(--bad); color:white;
      font-size:12px; font-weight:1000;
      margin-left:2px;
    }

    .btn{
      border:0; cursor:pointer; font-weight:1000;
      border-radius:14px;
      padding:12px 14px;
      transition: transform .15s ease, filter .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      color:#1b120c;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      box-shadow: 0 12px 30px rgba(215,163,106,.18);
    }
    .btn-ghost{
      color:var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
    }
    .btn-danger{
      color:#fff;
      background: rgba(255,91,91,.92);
    }

    .hamburger{
      display:none;
      width:44px; height:44px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      cursor:pointer;
    }

    /* ---------- HERO ---------- */
    .hero{
      padding:22px 0 10px;
    }
    .hero-card{
      border:1px solid var(--border);
      border-radius:24px;
      overflow:hidden;
      background:
        radial-gradient(900px 500px at 0% 0%, rgba(215,163,106,.18), transparent 60%),
        radial-gradient(700px 380px at 100% 10%, rgba(122,74,47,.25), transparent 60%),
        linear-gradient(135deg, rgba(18,27,39,.72), rgba(18,27,39,.45));
      box-shadow: var(--shadow);
    }
    .hero-inner{
      padding:28px 18px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:center;
    }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(26px, 2.8vw, 44px);
      letter-spacing: .2px;
      font-weight:1100;
    }
    .hero p{
      margin:0;
      color:rgba(234,240,255,.86);
      font-weight:850;
      line-height:1.55;
    }
    .hero-bullets{
      margin-top:12px;
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(215,163,106,.22);
      background: rgba(215,163,106,.08);
      color:rgba(255,236,215,.95);
      font-weight:950;
      font-size:13px;
    }
    .hero-cta{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;
    }

    .hero-side{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(15,22,32,.55);
      border-radius:20px;
      padding:16px;
    }
    .hero-side h3{ margin:0 0 8px; font-size:16px; font-weight:1050; }
    .hero-side .muted{ color:var(--muted); font-weight:900; font-size:13px; }
    .hero-side .row{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 0;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-weight:950;
    }
    .hero-side .row:last-child{ border-bottom:0; padding-bottom:0; }
    .tag{
      font-size:12px; font-weight:1000;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:rgba(234,240,255,.90);
      display:inline-flex; align-items:center; gap:6px;
    }

    /* ---------- TOOLBAR (Search + Filters) ---------- */
    .toolbar-wrap{
      position:sticky;
      top:var(--headerH);
      z-index:1100;
      border-bottom:1px solid var(--border);
      background: linear-gradient(180deg, rgba(11,15,20,.92), rgba(11,15,20,.70));
      backdrop-filter: blur(14px);
    }
    .toolbar{
      padding:12px 0;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      flex-wrap:wrap;
    }
    .search{
      flex:1;
      min-width:240px;
      display:flex; gap:10px; align-items:center;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius:16px;
      padding:10px 12px;
    }
    .search input{
      width:100%;
      background: transparent;
      border:0;
      outline:none;
      color:var(--text);
      font-weight:900;
    }
    .search input::placeholder{ color: rgba(169,182,210,.8); }

    .filters{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    }
    .filter-btn{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: rgba(234,240,255,.92);
      cursor:pointer;
      font-weight:1000;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .filter-btn:hover{ transform: translateY(-1px); border-color: rgba(215,163,106,.28); }
    .filter-btn.active{
      background: rgba(215,163,106,.14);
      border-color: rgba(215,163,106,.30);
      color: rgba(255,240,220,.98);
    }

    /* ---------- PRODUCTS ---------- */
    .main{ padding:18px 0 50px; }
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .cardp{
      grid-column: span 4;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(18,27,39,.75), rgba(18,27,39,.55));
      border-radius:20px;
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      position:relative;
    }
    .cardp:hover{ transform: translateY(-4px); border-color: rgba(215,163,106,.22); }
    .img{
      height:260px; background: rgba(255,255,255,.04);
      overflow:hidden; position:relative;
    }
    .img img{ width:100%; height:100%; object-fit:cover; display:block; }
    .img:after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, transparent 60%, rgba(0,0,0,.45));
      pointer-events:none;
    }
    .badge{
      position:absolute; top:12px; left:12px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(11,15,20,.65);
      border:1px solid rgba(255,255,255,.10);
      font-weight:1000;
      font-size:12px;
      color: rgba(234,240,255,.92);
      backdrop-filter: blur(8px);
    }
    .content{ padding:14px; }
    .name{
      font-weight:1100;
      font-size:16px;
      margin:0;
    }
    .desc{
      margin:8px 0 0;
      color: rgba(169,182,210,.92);
      font-weight:850;
      font-size:13px;
      line-height:1.5;
      min-height: 38px;
    }
    .row2{
      margin-top:12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .price{
      font-weight:1150;
      font-size:18px;
      color: rgba(255,236,215,.98);
    }
    .add{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(215,163,106,.24);
      background: rgba(215,163,106,.12);
      color: rgba(255,240,220,.98);
      font-weight:1100;
      cursor:pointer;
    }
    .add:hover{ background: rgba(215,163,106,.16); }

    .loading{
      margin:18px auto 0;
      padding:16px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(169,182,210,.92);
      font-weight:900;
      max-width: var(--container);
    }

    /* ---------- PANELS / ADMIN ---------- */
    .panel{ padding:18px 0 50px; }
    .panel-card{
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(18,27,39,.75), rgba(18,27,39,.55));
      border-radius:22px;
      box-shadow: var(--shadow);
      padding:16px;
    }
    .panel-head{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .panel-head h2{ margin:0; font-size:18px; font-weight:1100; }
    .subtext{ margin:0; color: rgba(169,182,210,.90); font-weight:850; }

    .admin-panel{
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(18,27,39,.75), rgba(18,27,39,.55));
      border-radius:22px;
      box-shadow: var(--shadow);
      padding:16px;
    }

    label{ display:block; margin-top:10px; font-weight:1000; color: rgba(234,240,255,.95); }
    input, textarea, select{
      width:100%;
      margin-top:6px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: var(--text);
      outline:none;
      font-weight:900;
    }
    textarea{ resize: vertical; }
    select option{ color:#111; }

    .image-upload-area{
      margin-top:10px;
      border:1px dashed rgba(255,255,255,.18);
      border-radius:18px;
      padding:14px;
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition: border-color .15s ease, background .15s ease;
    }
    .image-upload-area:hover{ border-color: rgba(215,163,106,.28); background: rgba(255,255,255,.05); }
    .image-preview{ width:100%; max-height:280px; object-fit:cover; border-radius:16px; margin-top:10px; border:1px solid rgba(255,255,255,.10); }

    .list{ margin-top:12px; }
    .item{
      display:flex; gap:12px; align-items:center;
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      background: rgba(255,255,255,.04);
      margin-bottom:10px;
    }
    .thumb{
      width:74px; height:74px; border-radius:16px; overflow:hidden;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .item .meta{ flex:1; }
    .item .meta h3{ margin:0; font-size:15px; font-weight:1100; }
    .item .meta p{ margin:6px 0 0; color: rgba(169,182,210,.90); font-weight:850; font-size:13px; }
    .item .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    .hidden{ display:none !important; }

    /* ---------- MODALS / DRAWER ---------- */
    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.58);
      display:flex; align-items:center; justify-content:center;
      padding:18px;
      z-index:3000;
    }
    .modal{
      width:min(740px, 100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(18,27,39,.92), rgba(18,27,39,.80));
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      padding:14px;
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .modal-head h2{ margin:0; font-size:18px; font-weight:1100; }
    .muted{ color: rgba(169,182,210,.92); font-weight:850; font-size:13px; margin:6px 0 0; }
    .hr{ height:1px; background: rgba(255,255,255,.10); margin:12px 0; }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }

    .drawer-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      z-index:3500;
      display:flex; justify-content:flex-end;
    }
    .drawer{
      width:min(420px, 100%);
      height:100%;
      background: linear-gradient(180deg, rgba(18,27,39,.95), rgba(18,27,39,.85));
      border-left:1px solid rgba(255,255,255,.10);
      padding:14px;
      overflow:auto;
    }
    .cart-item{
      display:flex; gap:12px; align-items:center;
      padding:12px 0;
      border-bottom:1px solid rgba(255,255,255,.08);
      position:relative;
    }
    .cart-thumb{
      width:66px; height:66px;
      border-radius:16px; overflow:hidden;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .cart-thumb img{ width:100%; height:100%; object-fit:cover; }
    .qty{
      display:flex; gap:8px; align-items:center;
      margin-top:6px;
    }
    .qty button{
      width:34px; height:34px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--text);
      font-weight:1100;
      cursor:pointer;
    }
    .qty span{ min-width:24px; text-align:center; font-weight:1100; }
    .remove-x{
      position:absolute; right:0; top:10px;
      width:34px; height:34px;
      border-radius:12px;
      border:1px solid rgba(255,91,91,.35);
      background: rgba(255,91,91,.12);
      color: rgba(255,210,210,.98);
      font-weight:1100;
      cursor:pointer;
      display:grid; place-items:center;
    }

    /* ---------- FOOTER ---------- */
    .footer{
      border-top:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      padding:24px 0;
      color: rgba(234,240,255,.92);
    }
    .footer-grid{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap:14px;
    }
    .footer h3{ margin:0 0 10px; font-weight:1100; }
    .footer p{ margin:0; color: rgba(169,182,210,.90); font-weight:850; line-height:1.6; }
    .footer a{ color: rgba(255,236,215,.95); font-weight:950; }
    .footer-bottom{
      margin-top:16px;
      padding-top:12px;
      border-top:1px solid rgba(255,255,255,.08);
      color: rgba(169,182,210,.90);
      font-weight:850;
      font-size:13px;
    }

    /* ---------- MOBILE ---------- */
    @media (max-width: 980px){
      .cardp{ grid-column: span 6; }
      .hero-inner{ grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      :root{ --headerH:68px; }
      .cardp{ grid-column: span 12; }
      .nav-links{ display:none; }
      .hamburger{ display:inline-grid; place-items:center; }
      .footer-grid{ grid-template-columns:1fr; }
    }

    /* mobile menu */
    .mobile-menu{
      position:fixed; inset:0;
      z-index:2000;
      background: rgba(140, 85, 85, 0.6);
      display:flex; justify-content:center; align-items:flex-start;
      padding:16px;
    }
    .mobile-sheet{
      width:min(520px, 100%);
      margin-top:10px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(18,27,39,.96), rgba(18,27,39,.86));
      box-shadow: 0 25px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .mobile-sheet .top{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .mobile-sheet .links{
      padding:12px;
      display:grid;
      gap:10px;
    }
    .mobile-sheet .links .btn{ width:100%; text-align:left; }
  </style>
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <div class="container nav">
      <div class="brand" onclick="showShop()">
        <div class="brand-badge">‚òï</div>
        <div class="brand-title">
          <b>Yordi Coffee</b>
          <span>Fresh ‚Ä¢ Affordable ‚Ä¢ Fast Delivery</span>
        </div>
      </div>

      <div class="nav-actions">
        <div class="nav-links">
          <div class="chip" onclick="showShop()">üõçÔ∏è <span>Shop</span></div>
          <div class="chip" onclick="openOrders()">üì¶ <span>My Orders</span></div>
          <div class="chip" onclick="openAdmin()">üõ†Ô∏è <span>Admin</span></div>
        </div>

        <div class="chip" onclick="openAccountMenu()">
          üë§ <span id="authLabel">Login</span>
        </div>

        <div class="chip" onclick="openCart()">
          üõí <span>Cart</span> <span class="count" id="cartCount">0</span>
        </div>

        <button class="hamburger" onclick="openMobileMenu()" aria-label="Menu">‚ò∞</button>
      </div>
    </div>
  </header>

  <!-- MOBILE MENU -->
  <div id="mobileMenu" class="mobile-menu hidden" onclick="if(event.target.id==='mobileMenu') closeMobileMenu()">
    <div class="mobile-sheet">
      <div class="top">
        <div style="display:flex;align-items:center;gap:10px;font-weight:1100;">
          <span style="width:38px;height:38px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);">‚òï</span>
          <div>
            <div>Yordi Coffee</div>
            <div style="font-size:12px;color:rgba(169,182,210,.92);font-weight:900;margin-top:2px;">Menu</div>
          </div>
        </div>
        <button class="btn btn-ghost" onclick="closeMobileMenu()">‚úï</button>
      </div>
      <div class="links">
        <button class="btn btn-ghost" onclick="closeMobileMenu(); showShop();">üõçÔ∏è Shop</button>
        <button class="btn btn-ghost" onclick="closeMobileMenu(); openOrders();">üì¶ My Orders</button>
        <button class="btn btn-ghost" onclick="closeMobileMenu(); openAdmin();">üõ†Ô∏è Admin</button>
        <button class="btn btn-primary" onclick="closeMobileMenu(); openCart();">üõí Open Cart</button>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <div class="hero-card">
        <div class="hero-inner">
          <div>
            <h1>Fresh Coffee, Delivered to You</h1>
            <p>Order beans, ground coffee, espresso, traditional coffee, and accessories ‚Äî high quality, affordable, and delivered fast.</p>

            <div class="hero-bullets">
              <span class="pill">‚≠ê Premium taste</span>
              <span class="pill">üöö Fast delivery</span>
              <span class="pill">üí≥ Telebirr / Cash</span>
              <span class="pill">üõçÔ∏è Accessories</span>
            </div>

            <div class="hero-cta">
              <button class="btn btn-primary" onclick="scrollToShop()">Shop Coffee</button>
              <button class="btn btn-ghost" onclick="openOrders()">Track Orders</button>
            </div>
          </div>

          <div class="hero-side">
            <h3>Today‚Äôs Quick Info</h3>
            <div class="muted">Everything you need in one place.</div>
            <div style="margin-top:10px;">
              <div class="row"><span class="tag">‚òï Beans</span><span class="muted">Roasts & origin</span></div>
              <div class="row"><span class="tag">üßä Ground</span><span class="muted">Ready to brew</span></div>
              <div class="row"><span class="tag">‚ö° Espresso</span><span class="muted">Strong & smooth</span></div>
              <div class="row"><span class="tag">üè∫ Traditional</span><span class="muted">Authentic style</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- TOOLBAR -->
  <div class="toolbar-wrap" id="shopSection">
    <div class="container toolbar">
      <div class="search">
        üîé
        <input id="searchInput" placeholder="Search coffee (e.g., Yirgacheffe, espresso, grinder)..." oninput="applySearch()" />
      </div>

      <div class="filters">
        <button class="filter-btn active" onclick="filterProducts('all', this)">All</button>
        <button class="filter-btn" onclick="filterProducts('beans', this)">Beans</button>
        <button class="filter-btn" onclick="filterProducts('ground', this)">Ground</button>
        <button class="filter-btn" onclick="filterProducts('espresso', this)">Espresso</button>
        <button class="filter-btn" onclick="filterProducts('traditional', this)">Traditional</button>
        <button class="filter-btn" onclick="filterProducts('accessories', this)">Accessories</button>
      </div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <main class="main">
    <div class="container">
      <div id="loadingProducts" class="loading">Loading coffee...</div>
      <div class="grid" id="productsGrid"></div>
    </div>
  </main>

  <!-- ORDERS -->
  <div id="ordersSection" class="panel hidden">
    <div class="container">
      <div class="panel-card">
        <div class="panel-head">
          <h2>üì¶ My Orders</h2>
          <button class="btn btn-ghost" onclick="showShop()">‚Üê Back to Shop</button>
        </div>
        <p class="subtext">Login required to view your order history.</p>
        <div id="ordersList" style="margin-top:12px;"></div>
      </div>
    </div>
  </div>

  <!-- ADMIN -->
  <div id="adminSection" class="panel hidden">
    <div class="container">
      <div class="admin-panel">
        <div class="panel-head">
          <h2>üõ† Admin Dashboard</h2>
          <button class="btn btn-ghost" onclick="showShop()">‚Üê Back to Shop</button>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 12px;">
          <button class="btn btn-primary" onclick="adminSetKey()">Set Admin Key</button>
          <button class="btn btn-ghost" onclick="adminTestKey()">Test Key</button>
          <button class="btn btn-danger" onclick="adminLogout()">Logout</button>
        </div>

        <p class="subtext">
          Admin is protected by <b>ADMIN_API_KEY</b>. Key is stored only in your browser (localStorage).
        </p>

        <div class="hr"></div>

        <h3 style="margin:0 0 10px;font-weight:1100;">Add New Coffee Item</h3>

        <form id="productForm">
          <div class="image-upload-area" onclick="document.getElementById('imageInput').click()">
            <div style="font-weight:1000;">üì∑ Upload Image (optional, max 2MB)</div>
            <div class="muted">Clear, high-quality images look best on the shop.</div>
            <input type="file" id="imageInput" accept="image/*" style="display:none;">
            <img id="imagePreview" class="image-preview hidden" alt="Preview">
          </div>

          <label>Item Name</label>
          <input id="productName" required placeholder="e.g., Yirgacheffe Beans 1kg">

          <label>Description</label>
          <textarea id="productDescription" rows="3" placeholder="Taste notes, roast level, size..."></textarea>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:6px;">
            <div>
              <label>Category</label>
              <select id="productCategory" required>
                <option value="beans">Beans</option>
                <option value="ground">Ground</option>
                <option value="espresso">Espresso</option>
                <option value="traditional">Traditional</option>
                <option value="accessories">Accessories</option>
              </select>
            </div>
            <div>
              <label>Price (ETB)</label>
              <input type="number" id="productPrice" step="0.01" required placeholder="e.g., 1200">
            </div>
          </div>

          <button class="btn btn-primary" id="addBtn" type="submit" style="width:100%;margin-top:12px;">Add Item</button>
          <p id="adminStatus" style="margin-top:10px;color:rgba(169,182,210,.92);font-weight:1000;"></p>
        </form>

        <div class="hr"></div>

        <h3 style="margin:0 0 10px;font-weight:1100;">Manage Coffee</h3>
        <div class="list" id="productList"></div>

        <div class="hr"></div>

        <h3 style="margin:0 0 10px;font-weight:1100;">üì¶ Customer Orders (Admin Only)</h3>
        <div id="adminOrders" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <!-- EDIT MODAL -->
  <div id="editModal" class="backdrop hidden" onclick="if(event.target.id==='editModal') closeEditModal()">
    <div class="modal">
      <div class="modal-head">
        <h2>Edit Item</h2>
        <button class="btn btn-ghost" onclick="closeEditModal()">‚úï</button>
      </div>
      <div class="muted">Update item details and optionally replace image.</div>

      <input id="editId" type="hidden" />

      <label>Name</label>
      <input id="editName" />

      <label>Description</label>
      <textarea id="editDescription" rows="3"></textarea>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div>
          <label>Category</label>
          <select id="editCategory">
            <option value="beans">Beans</option>
            <option value="ground">Ground</option>
            <option value="espresso">Espresso</option>
            <option value="traditional">Traditional</option>
            <option value="accessories">Accessories</option>
          </select>
        </div>
        <div>
          <label>Price (ETB)</label>
          <input id="editPrice" type="number" step="0.01" />
        </div>
      </div>

      <label>Replace Image (optional, max 2MB)</label>
      <input id="editImage" type="file" accept="image/*" />
      <img id="editPreview" class="image-preview hidden" alt="Preview" />

      <div class="hr"></div>

      <div class="actions">
        <button class="btn btn-primary" onclick="saveEditProduct()">Save</button>
        <button class="btn btn-danger" onclick="closeEditModal()">Cancel</button>
      </div>

      <p id="editMsg" style="margin-top:10px;color:var(--bad);font-weight:1000;"></p>
    </div>
  </div>

  <!-- CART DRAWER -->
  <div id="cartDrawer" class="drawer-backdrop hidden" onclick="if(event.target.id==='cartDrawer'){closeCart()}">
    <div class="drawer">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
        <h2 style="margin:0;font-size:18px;font-weight:1100;">üõí Cart</h2>
        <button class="btn btn-ghost" onclick="closeCart()">‚úï</button>
      </div>

      <div id="cartItems" style="margin-top:10px;"></div>

      <div class="hr"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;font-weight:1100;">
        <span style="color:rgba(169,182,210,.92);">Subtotal</span>
        <span id="cartSubtotal" style="font-weight:1200;">0 ETB</span>
      </div>

      <button class="btn btn-ghost" style="width:100%;margin-top:10px;" onclick="continueShopping()">Continue Shopping</button>
      <button class="btn btn-primary" style="width:100%;margin-top:10px;" onclick="openCheckout()">Checkout</button>
      <button class="btn btn-danger" style="width:100%;margin-top:10px;" onclick="clearCart()">Clear Cart</button>
    </div>
  </div>

  <!-- CHECKOUT MODAL -->
  <div id="checkoutModal" class="backdrop hidden" onclick="if(event.target.id==='checkoutModal') closeCheckout()">
    <div class="modal">
      <div class="modal-head">
        <h2>‚úÖ Checkout</h2>
        <button class="btn btn-ghost" onclick="closeCheckout()">‚úï</button>
      </div>
      <div class="muted">Fill your details and place your order.</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;">
        <div>
          <label>Full Name</label>
          <input id="ckFullName" placeholder="Full name">
        </div>
        <div>
          <label>Phone</label>
          <input id="ckPhone" placeholder="+251...">
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div>
          <label>Email (optional)</label>
          <input id="ckEmail" placeholder="you@example.com">
        </div>
        <div>
          <label>City</label>
          <input id="ckCity" placeholder="Addis Ababa">
        </div>
      </div>

      <label>Address</label>
      <input id="ckAddress" placeholder="Street, building, etc...">

      <label>Country</label>
      <input id="ckCountry" value="Ethiopia">

      <label>Order Notes (optional)</label>
      <textarea id="ckNotes" rows="3" placeholder="Any special request..."></textarea>

      <div class="hr"></div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div>
          <label>Payment Method</label>
          <select id="ckPaymentMethod">
            <option value="cash">Cash on Delivery</option>
            <option value="card">Card</option>
            <option value="telebirr">Telebirr</option>
          </select>
        </div>
        <div>
          <label>Total</label>
          <input id="ckTotal" disabled>
        </div>
      </div>

      <label>Telebirr Reference (if Telebirr)</label>
      <input id="ckTelebirrRef" placeholder="TB123...">

      <div class="actions">
        <button class="btn btn-primary" onclick="placeOrder()">Place Order</button>
        <button class="btn btn-ghost" onclick="closeCheckout()">Cancel</button>
      </div>

      <p id="checkoutMsg" style="margin-top:10px;color:var(--bad);font-weight:1000;"></p>
    </div>
  </div>

  <!-- AUTH MODAL -->
  <div id="authModal" class="backdrop hidden" onclick="if(event.target.id==='authModal') closeAuth()">
    <div class="modal" style="width:min(520px, 100%);">
      <div class="modal-head">
        <h2 id="authTitle">Login</h2>
        <button class="btn btn-ghost" onclick="closeAuth()">‚úï</button>
      </div>
      <div id="authSubtitle" class="muted">Login to see your orders and checkout faster.</div>

      <!-- LOGIN -->
      <div id="authFormLogin" style="margin-top:10px;">
        <label>Email</label>
        <input id="loginEmail" placeholder="email@example.com" />

        <label>Password</label>
        <input id="loginPassword" type="password" placeholder="******" />

        <div class="actions">
          <button class="btn btn-primary" onclick="doLogin()">Login</button>
          <button class="btn btn-ghost" onclick="switchToRegister()">Create account</button>
        </div>

        <p id="authMsg" style="margin-top:10px;color:var(--bad);font-weight:1000;"></p>
      </div>

      <!-- REGISTER -->
      <div id="authFormRegister" class="hidden" style="margin-top:10px;">
        <label>Full Name</label>
        <input id="regFullName" placeholder="Your name" />

        <label>Email</label>
        <input id="regEmail" placeholder="email@example.com" />

        <label>Password</label>
        <input id="regPassword" type="password" placeholder="min 6 chars" />

        <div class="actions">
          <button class="btn btn-primary" onclick="doRegister()">Register</button>
          <button class="btn btn-ghost" onclick="switchToLogin()">Back to login</button>
        </div>

        <p id="authMsg2" style="margin-top:10px;color:var(--bad);font-weight:1000;"></p>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div>
          <h3>‚òï Yordi Coffee</h3>
          <p>Fresh coffee products ‚Äî beans, ground coffee, espresso, traditional coffee & accessories.</p>
        </div>
        <div>
          <h3>Support</h3>
          <p>Email: <a href="mailto:info@yordicoffee.com">info@yordicoffee.com</a></p>
        </div>
        <div>
          <h3>Hours</h3>
          <p>Mon‚ÄìSat: 8:00 AM ‚Äì 8:00 PM</p>
          <p>Sunday: Closed</p>
        </div>
      </div>

      <div class="footer-bottom">
        ¬© <span id="yy"></span> Yordi Coffee. All rights reserved.
      </div>
    </div>
  </footer>

<script>
  // ‚úÖ Your deployed backend:
  const BACKEND_URL = "https://coffee-1-5gfb.onrender.com";

  const API_BASE =
    (location.hostname === "localhost" || location.hostname === "127.0.0.1")
      ? "http://localhost:3000"
      : BACKEND_URL;

  console.log("API_BASE:", API_BASE);

  let products = [];
  let currentFilter = "all";
  let searchText = "";
  let cart = JSON.parse(localStorage.getItem("YORDI_CART") || "[]");

  // ---- Admin key ----
  const ADMIN_KEY_STORAGE = "YORDI_ADMIN_KEY";
  const getAdminKey = () => localStorage.getItem(ADMIN_KEY_STORAGE) || "";
  const setAdminKey = (k) => localStorage.setItem(ADMIN_KEY_STORAGE, k);
  const clearAdminKey = () => localStorage.removeItem(ADMIN_KEY_STORAGE);

  // ---- Auth token ----
  const AUTH_TOKEN_KEY = "YORDI_AUTH_TOKEN";
  const getToken = () => localStorage.getItem(AUTH_TOKEN_KEY) || "";
  const setToken = (t) => localStorage.setItem(AUTH_TOKEN_KEY, t);
  const clearToken = () => localStorage.removeItem(AUTH_TOKEN_KEY);

  // ---- Admin lock/unlock ----
  let adminUnlocked = false;

  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function formatMoney(n){ return (Number(n)||0).toFixed(0); }

  async function readJsonSafe(res){
    const text = await res.text();
    try { return { text, json: JSON.parse(text) }; }
    catch { return { text, json: null }; }
  }

  // smoother scroll without ‚Äúdisappearing‚Äù feeling
  function scrollToShop(){
    const el = document.getElementById("shopSection");
    const y = el.getBoundingClientRect().top + window.scrollY - 6; // toolbar is sticky below header
    window.scrollTo({ top: y, behavior:"smooth" });
  }

  function saveCart(){
    localStorage.setItem("YORDI_CART", JSON.stringify(cart));
    updateCartCount();
  }

  function updateCartCount(){
    const count = cart.reduce((s, it) => s + (Number(it.qty)||1), 0);
    document.getElementById("cartCount").textContent = count;
  }

  function cartSubtotal(){
    return cart.reduce((s, it) => s + (Number(it.price)||0) * (Number(it.qty)||1), 0);
  }

  function showShop(){
    document.getElementById("ordersSection").classList.add("hidden");
    document.getElementById("adminSection").classList.add("hidden");
    scrollToShop();
  }

  function continueShopping(){ closeCart(); showShop(); }

  // mobile menu
  function openMobileMenu(){ document.getElementById("mobileMenu").classList.remove("hidden"); }
  function closeMobileMenu(){ document.getElementById("mobileMenu").classList.add("hidden"); }

  async function verifyAdminKey(key){
    const res = await fetch(API_BASE + "/api/admin/verify", {
      headers: { "x-admin-key": key }
    });
    return res.ok;
  }

  // ------------------ ADMIN ------------------
  async function adminSetKey(){
    const k = prompt("Enter ADMIN_API_KEY:");
    if(!k) return false;

    try{
      const ok = await verifyAdminKey(k.trim());
      if(!ok){
        alert("‚ùå Wrong admin key.");
        return false;
      }
      setAdminKey(k.trim());
      adminUnlocked = true;
      alert("‚úÖ Admin unlocked.");
      return true;
    }catch(e){
      alert("Verify error: " + e.message);
      return false;
    }
  }

  function adminLogout(){
    clearAdminKey();
    adminUnlocked = false;
    alert("‚úÖ Admin locked.");
  }

  async function adminTestKey(){
    const key = getAdminKey();
    if(!key) return alert("Admin key not set. Click 'Set Admin Key'.");

    const ok = await verifyAdminKey(key);
    if(!ok){
      clearAdminKey();
      adminUnlocked = false;
      return alert("‚ùå Key invalid. Please set again.");
    }
    alert("‚úÖ Admin key works.");
  }

  async function openAdmin(){
    if(!adminUnlocked){
      const saved = getAdminKey();
      if(saved){
        const ok = await verifyAdminKey(saved);
        if(ok) adminUnlocked = true;
        else clearAdminKey();
      }
    }
    if(!adminUnlocked){
      const ok = await adminSetKey();
      if(!ok) return;
    }

    document.getElementById("ordersSection").classList.add("hidden");
    document.getElementById("adminSection").classList.remove("hidden");
    window.scrollTo({ top: document.getElementById("adminSection").offsetTop - 10, behavior:"smooth" });

    renderAdminList();
    await loadAdminOrders();
  }

  // ------------------ ORDERS ------------------
  async function openOrders(){
    document.getElementById("adminSection").classList.add("hidden");
    document.getElementById("ordersSection").classList.remove("hidden");
    window.scrollTo({ top: document.getElementById("ordersSection").offsetTop - 10, behavior:"smooth" });

    if(!getToken()){
      document.getElementById("ordersList").innerHTML =
        '<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;color:rgba(169,182,210,.92);background:rgba(255,255,255,.04);font-weight:900;">Please login to view orders. <span style="color:rgba(255,236,215,.95);font-weight:1100;cursor:pointer;text-decoration:underline;" onclick="openAuth()">Login</span></div>';
      return;
    }
    await loadMyOrders();
  }

  // ------------------ PRODUCTS ------------------
  async function loadProducts(){
    const loading = document.getElementById("loadingProducts");
    const grid = document.getElementById("productsGrid");
    const url = API_BASE + "/api/coffee";

    loading.classList.remove("hidden");
    loading.innerHTML = "Loading coffee...";
    grid.innerHTML = "";

    try {
      const res = await fetch(url, { cache: "no-store" });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(`Backend ${res.status}: ${json?.details || json?.error || text || "Unknown error"}`);

      products = Array.isArray(json) ? json : [];
      loading.classList.add("hidden");

      renderProducts();
      renderAdminList();
    } catch (err) {
      console.error(err);
      loading.innerHTML = `
        <div style="color:rgba(255,91,91,.95);font-weight:1100;">Failed to load coffee from backend.</div>
        <div style="color:rgba(169,182,210,.92);margin-top:8px;font-weight:900;line-height:1.6;">
          API_BASE: <b>${escapeHtml(API_BASE)}</b><br/>
          URL: <b>${escapeHtml(url)}</b><br/>
          Error: <b>${escapeHtml(err.message || String(err))}</b>
        </div>
        <div style="margin-top:10px;">
          <button class="btn btn-primary" onclick="loadProducts()">Retry</button>
        </div>
      `;
    }
  }

  function applySearch(){
    searchText = (document.getElementById("searchInput")?.value || "").trim().toLowerCase();
    renderProducts();
  }

  function filterProducts(category, btnEl){
    currentFilter = category;
    document.querySelectorAll(".filter-btn").forEach(btn => btn.classList.remove("active"));
    if (btnEl) btnEl.classList.add("active");
    renderProducts();
  }

  function renderProducts(){
    const grid = document.getElementById("productsGrid");

    let filtered = (currentFilter === "all")
      ? products
      : products.filter(p => String(p.category || "") === String(currentFilter));

    if(searchText){
      filtered = filtered.filter(p => {
        const name = String(p.name || "").toLowerCase();
        const desc = String(p.description || "").toLowerCase();
        const cat  = String(p.category || "").toLowerCase();
        return name.includes(searchText) || desc.includes(searchText) || cat.includes(searchText);
      });
    }

    if (!filtered.length) {
      grid.innerHTML = `<div style="grid-column:1/-1;padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">No items found.</div>`;
      return;
    }

    grid.innerHTML = filtered.map(p => `
      <div class="cardp">
        <div class="img">
          <div class="badge">${escapeHtml(p.category || "coffee")}</div>
          <img src="${p.image || ''}" alt="${escapeHtml(p.name || 'Coffee')}" onerror="this.style.display='none'">
        </div>
        <div class="content">
          <p class="name">${escapeHtml(p.name || '')}</p>
          ${p.description ? `<p class="desc">${escapeHtml(p.description)}</p>` : `<p class="desc">Smooth taste, fresh roast, and premium quality.</p>`}
          <div class="row2">
            <div class="price">${formatMoney(p.price)} ETB</div>
            <button class="add" onclick="addToCart('${String(p._id)}')">Add</button>
          </div>
        </div>
      </div>
    `).join("");
  }

  function addToCart(mongoId){
    const p = products.find(x => String(x._id) === String(mongoId));
    if(!p) return alert("Item not found");

    const existing = cart.find(x => String(x.productId) === String(mongoId));
    if(existing) existing.qty = (Number(existing.qty)||1) + 1;
    else cart.push({ productId: String(p._id), name: p.name, price: Number(p.price)||0, qty: 1, image: p.image || "" });

    saveCart();
    openCart();
  }

  // ------------------ CART ------------------
  function removeFromCart(productId){
    cart = cart.filter(x => String(x.productId) !== String(productId));
    saveCart();
    renderCart();
  }

  function changeQty(productId, delta){
    const it = cart.find(x => String(x.productId) === String(productId));
    if(!it) return;
    it.qty = Math.max(1, (Number(it.qty)||1) + delta);
    saveCart();
    renderCart();
  }

  function clearCart(){
    if(!confirm("Clear cart?")) return;
    cart = [];
    saveCart();
    renderCart();
  }

  function openCart(){
    document.getElementById("cartDrawer").classList.remove("hidden");
    renderCart();
  }

  function closeCart(){
    document.getElementById("cartDrawer").classList.add("hidden");
  }

  function renderCart(){
    const box = document.getElementById("cartItems");
    if(cart.length === 0){
      box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">Your cart is empty.</div>`;
      document.getElementById("cartSubtotal").textContent = "0 ETB";
      return;
    }

    box.innerHTML = cart.map(it => `
      <div class="cart-item">
        <div class="cart-thumb"><img src="${it.image || ''}" onerror="this.style.display='none'"></div>
        <div style="flex:1;">
          <div style="font-weight:1100;">${escapeHtml(it.name || "")}</div>
          <div style="color:rgba(255,236,215,.95);font-weight:1100;margin-top:4px;">${formatMoney(it.price)} ETB</div>
          <div class="qty">
            <button onclick="changeQty('${escapeHtml(it.productId)}', -1)">-</button>
            <span>${Number(it.qty)||1}</span>
            <button onclick="changeQty('${escapeHtml(it.productId)}', 1)">+</button>
          </div>
        </div>
        <div class="remove-x" title="Remove" onclick="removeFromCart('${escapeHtml(it.productId)}')">‚úï</div>
      </div>
    `).join("");

    document.getElementById("cartSubtotal").textContent = `${formatMoney(cartSubtotal())} ETB`;
  }

  // ------------------ CHECKOUT ------------------
  function openCheckout(){
    if(cart.length === 0) return alert("Cart is empty");
    if(!getToken()){
      alert("Please login first to checkout.");
      openAuth();
      return;
    }
    document.getElementById("checkoutMsg").textContent = "";
    document.getElementById("ckTotal").value = formatMoney(cartSubtotal()) + " ETB";
    document.getElementById("checkoutModal").classList.remove("hidden");
  }
  function closeCheckout(){ document.getElementById("checkoutModal").classList.add("hidden"); }

  async function placeOrder(){
    const msgEl = document.getElementById("checkoutMsg");
    msgEl.textContent = "";

    const fullName = document.getElementById("ckFullName").value.trim();
    const phone = document.getElementById("ckPhone").value.trim();
    const email = document.getElementById("ckEmail").value.trim();
    const address = document.getElementById("ckAddress").value.trim();
    const city = document.getElementById("ckCity").value.trim();
    const country = document.getElementById("ckCountry").value.trim();
    const notes = document.getElementById("ckNotes").value.trim();
    const paymentMethod = document.getElementById("ckPaymentMethod").value;
    const telebirrRef = document.getElementById("ckTelebirrRef").value.trim();

    if(!fullName) return msgEl.textContent = "Full name is required";
    if(!phone) return msgEl.textContent = "Phone is required";
    if(!address) return msgEl.textContent = "Address is required";

    const payload = {
      items: cart.map(it => ({ productId: it.productId, name: it.name, price: it.price, qty: it.qty, image: it.image || "" })),
      fullName, phone, email, address, city, country, notes,
      paymentMethod, telebirrRef
    };

    try{
      const res = await fetch(API_BASE + "/api/orders", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + getToken()
        },
        body: JSON.stringify(payload)
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Order failed");

      alert("‚úÖ Order placed! Order ID: " + (json?.order?.orderId || ""));
      closeCheckout();
      closeCart();
      cart = [];
      saveCart();
      await openOrders();
    }catch(e){
      msgEl.textContent = e.message;
    }
  }

  // ------------------ AUTH ------------------
  function openAuth(){ document.getElementById("authModal").classList.remove("hidden"); switchToLogin(); }
  function closeAuth(){ document.getElementById("authModal").classList.add("hidden"); }

  function switchToRegister(){
    document.getElementById("authTitle").textContent = "Create Account";
    document.getElementById("authSubtitle").textContent = "Register to track your orders anytime.";
    document.getElementById("authFormLogin").classList.add("hidden");
    document.getElementById("authFormRegister").classList.remove("hidden");
    document.getElementById("authMsg").textContent = "";
    document.getElementById("authMsg2").textContent = "";
  }

  function switchToLogin(){
    document.getElementById("authTitle").textContent = "Login";
    document.getElementById("authSubtitle").textContent = "Login to see your orders and checkout faster.";
    document.getElementById("authFormRegister").classList.add("hidden");
    document.getElementById("authFormLogin").classList.remove("hidden");
    document.getElementById("authMsg").textContent = "";
    document.getElementById("authMsg2").textContent = "";
  }

  function setAuthLabel(){
    document.getElementById("authLabel").textContent = getToken() ? "Account" : "Login";
  }

  function openAccountMenu(){
    if(!getToken()){ openAuth(); return; }
    const choice = prompt("Type: 1 = My Orders, 2 = Logout");
    if(choice === "1") openOrders();
    if(choice === "2"){ clearToken(); setAuthLabel(); alert("Logged out."); }
  }

  async function doRegister(){
    const msg = document.getElementById("authMsg2");
    msg.textContent = "";
    const fullName = document.getElementById("regFullName").value.trim();
    const email = document.getElementById("regEmail").value.trim();
    const password = document.getElementById("regPassword").value;

    try{
      const res = await fetch(API_BASE + "/api/auth/register", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ fullName, email, password })
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Register failed");
      setToken(json.token);
      setAuthLabel();
      closeAuth();
      alert("‚úÖ Account created! You are logged in.");
    }catch(e){ msg.textContent = e.message; }
  }

  async function doLogin(){
    const msg = document.getElementById("authMsg");
    msg.textContent = "";
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value;

    try{
      const res = await fetch(API_BASE + "/api/auth/login", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ email, password })
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Login failed");
      setToken(json.token);
      setAuthLabel();
      closeAuth();
      alert("‚úÖ Logged in!");
    }catch(e){ msg.textContent = e.message; }
  }

  async function loadMyOrders(){
    const box = document.getElementById("ordersList");
    box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">Loading...</div>`;

    try{
      const res = await fetch(API_BASE + "/api/orders/my", {
        headers: { "Authorization": "Bearer " + getToken() }
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Failed to load orders");

      const orders = Array.isArray(json) ? json : [];
      if(orders.length === 0){
        box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">No orders yet.</div>`;
        return;
      }

      box.innerHTML = orders.map(o => {
        const itemsHtml = (o.items || []).map(it => `
          <div style="display:flex;gap:10px;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.08);">
            <div style="flex:1;">
              <div style="font-weight:1100;">${escapeHtml(it.name || "")}</div>
              <div style="color:rgba(169,182,210,.92);font-weight:900;font-size:13px;">Qty: ${Number(it.qty)||1} ‚Ä¢ ${formatMoney(it.price)} ETB</div>
            </div>
          </div>
        `).join("");

        return `
          <div style="border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:14px;margin-bottom:12px;background:rgba(255,255,255,.04);">
            <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
              <div>
                <div style="font-weight:1100;font-size:15px;">Order: ${escapeHtml(o.orderId || "")}</div>
                <div style="color:rgba(169,182,210,.92);font-weight:900;font-size:13px;margin-top:4px;">
                  Status: ${escapeHtml(o.status || "placed")} ‚Ä¢ Payment: ${escapeHtml(o.payment?.method || "")} (${escapeHtml(o.payment?.status || "pending")})
                </div>
              </div>
              <div style="font-weight:1200;color:rgba(255,236,215,.98);font-size:15px;">${formatMoney(o.total)} ETB</div>
            </div>

            <div style="margin-top:10px;">${itemsHtml}</div>

            <div style="margin-top:10px;color:rgba(169,182,210,.92);font-weight:900;font-size:13px;">
              Placed: ${new Date(o.createdAt).toLocaleString()}
            </div>
          </div>
        `;
      }).join("");
    }catch(e){
      box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(255,91,91,.95);font-weight:1000;">${escapeHtml(e.message)}</div>`;
    }
  }

  // ------------------ ADMIN ORDERS ------------------
  async function loadAdminOrders(){
    const box = document.getElementById("adminOrders");
    const key = getAdminKey();
    if(!key){
      box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">
        Admin key not set. Click <b>Set Admin Key</b>.
      </div>`;
      return;
    }

    box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">Loading orders...</div>`;

    try{
      const res = await fetch(API_BASE + "/api/admin/orders", {
        headers: { "x-admin-key": key }
      });
      const { text, json } = await readJsonSafe(res);

      if(res.status === 401){
        clearAdminKey();
        adminUnlocked = false;
        throw new Error("Admin key invalid. Please open Admin again.");
      }
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Failed to load admin orders");

      const orders = Array.isArray(json) ? json : [];
      if(orders.length === 0){
        box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">No orders yet.</div>`;
        return;
      }

      box.innerHTML = orders.map(o => {
        const c = o.customer || {};
        const payMethod = o.payment?.method || "";
        const payStatus = o.payment?.status || "pending";

        const itemsHtml = (o.items || []).map(it => `
          <div style="display:flex;gap:10px;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.08);">
            <div style="width:56px;height:56px;border-radius:16px;overflow:hidden;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);flex:0 0 auto;">
              <img src="${it.image || ""}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">
            </div>
            <div style="flex:1;">
              <div style="font-weight:1100;">${escapeHtml(it.name || "")}</div>
              <div style="color:rgba(169,182,210,.92);font-weight:900;font-size:13px;">
                Qty: ${Number(it.qty)||1} ‚Ä¢ ${formatMoney(it.price)} ETB
              </div>
            </div>
          </div>
        `).join("");

        return `
          <div style="border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:14px;margin-bottom:12px;background:rgba(255,255,255,.04);">
            <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
              <div>
                <div style="font-weight:1100;font-size:15px;">Order: ${escapeHtml(o.orderId || "")}</div>
                <div style="color:rgba(169,182,210,.92);font-weight:900;font-size:13px;margin-top:4px;">
                  Status: <b>${escapeHtml(o.status || "placed")}</b> ‚Ä¢ Payment: <b>${escapeHtml(payMethod)}</b> (<b>${escapeHtml(payStatus)}</b>)
                </div>
                <div style="margin-top:8px;color:rgba(169,182,210,.92);font-weight:900;font-size:13px;line-height:1.6;">
                  Customer: <b>${escapeHtml(c.fullName || "")}</b> ‚Ä¢ ${escapeHtml(c.phone || "")} ‚Ä¢ ${escapeHtml(c.email || "")}<br>
                  Address: ${escapeHtml(c.address || "")}, ${escapeHtml(c.city || "")}, ${escapeHtml(c.country || "")}
                </div>
              </div>
              <div style="font-weight:1200;color:rgba(255,236,215,.98);font-size:15px;">${formatMoney(o.total)} ETB</div>
            </div>

            <div style="margin-top:10px;">${itemsHtml}</div>

            <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
              <select id="st_${o._id}">
                ${["placed","processing","delivered","cancelled"].map(s => `
                  <option value="${s}" ${String(o.status)===s ? "selected" : ""}>${s}</option>
                `).join("")}
              </select>

              <select id="pay_${o._id}">
                ${["pending","paid","failed"].map(s => `
                  <option value="${s}" ${String(payStatus)===s ? "selected" : ""}>${s}</option>
                `).join("")}
              </select>

              <button class="btn btn-primary" onclick="adminUpdateOrder('${o._id}')">Save</button>
            </div>

            <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
              <select id="mailtpl_${o._id}">
                <option value="paid">Payment Confirmed (Paid)</option>
                <option value="failed">Payment Failed</option>
                <option value="processing">Order Processing</option>
                <option value="delivered">Delivered</option>
                <option value="custom">Custom</option>
              </select>

              <input id="mailmsg_${o._id}" placeholder="Optional message to customer..." style="flex:1;min-width:240px;" />

              <button class="btn btn-ghost" onclick="adminEmailCustomer('${o._id}')">Email Customer</button>
            </div>

            <div style="margin-top:10px;color:rgba(169,182,210,.92);font-weight:900;font-size:13px;">
              Placed: ${new Date(o.createdAt).toLocaleString()}
            </div>
          </div>
        `;
      }).join("");

    }catch(e){
      box.innerHTML = `<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(255,91,91,.95);font-weight:1000;">
        ${escapeHtml(e.message)}
      </div>`;
    }
  }

  async function adminUpdateOrder(id){
    const key = getAdminKey();
    if(!key) return alert("Admin key not set.");

    const status = document.getElementById("st_" + id).value;
    const paymentStatus = document.getElementById("pay_" + id).value;

    try{
      const res = await fetch(API_BASE + "/api/admin/orders/" + encodeURIComponent(id), {
        method: "PUT",
        headers: {
          "Content-Type":"application/json",
          "x-admin-key": key
        },
        body: JSON.stringify({ status, paymentStatus })
      });
      const { text, json } = await readJsonSafe(res);
      if(res.status === 401) throw new Error("Unauthorized admin key.");
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Update failed");

      alert("‚úÖ Order updated!");
      await loadAdminOrders();
    }catch(e){
      alert("Update error: " + e.message);
    }
  }

  // ‚úÖ shows REAL backend error details
  async function adminEmailCustomer(id){
    const key = getAdminKey();
    if(!key) return alert("Admin key required.");

    const tpl = document.getElementById("mailtpl_" + id).value;
    const message = document.getElementById("mailmsg_" + id).value.trim();

    try{
      const ping = await fetch(API_BASE + "/api/health", { cache: "no-store" });
      if(!ping.ok) throw new Error("Backend not reachable (health check failed).");
    }catch(e){
      alert("Backend fetch failed. Check API_BASE and Render status.\n\n" + e.message);
      return;
    }

    try{
      const res = await fetch(API_BASE + "/api/admin/orders/" + encodeURIComponent(id) + "/email", {
        method: "POST",
        headers: {
          "Content-Type":"application/json",
          "x-admin-key": key
        },
        body: JSON.stringify({ template: tpl, message })
      });

      const text = await res.text();
      let json = null;
      try{ json = JSON.parse(text); }catch{}

      if(res.status === 401){
        clearAdminKey();
        adminUnlocked = false;
        throw new Error("Unauthorized admin key. Please open Admin again.");
      }
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Email failed");

      alert("‚úÖ Email sent to customer!");
    }catch(e){
      alert("Email error: " + e.message);
    }
  }

  // ------------------ ADMIN COFFEE LIST ------------------
  function renderAdminList(){
    const list = document.getElementById("productList");
    if(!list) return;

    if(!products.length){
      list.innerHTML = '<div style="padding:14px;border:1px solid rgba(255,255,255,.10);border-radius:18px;background:rgba(255,255,255,.04);color:rgba(169,182,210,.92);font-weight:900;">No items yet.</div>';
      return;
    }

    list.innerHTML = products.map(p => `
      <div class="item">
        <div class="thumb">
          <img src="${p.image || ''}" alt="${escapeHtml(p.name || '')}" onerror="this.style.display='none'">
        </div>
        <div class="meta">
          <h3>${escapeHtml(p.name || '')}</h3>
          <p><b>Category:</b> ${escapeHtml(p.category || '')} &nbsp;‚Ä¢&nbsp; <b>Price:</b> ${formatMoney(p.price)} ETB</p>
        </div>
        <div class="actions">
          <button class="btn btn-ghost" onclick="openEditProduct('${String(p._id)}')">Edit</button>
          <button class="btn btn-danger" onclick="deleteProduct('${String(p._id)}')">Delete</button>
        </div>
      </div>
    `).join("");
  }

  async function fileToBase64(file){
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  function setAdminStatus(msg, isError=false){
    const el = document.getElementById("adminStatus");
    if(!el) return;
    el.textContent = msg || "";
    el.style.color = isError ? "rgba(255,91,91,.95)" : "rgba(169,182,210,.92)";
  }

  async function addProduct(formEl){
    const key = getAdminKey();
    if(!key) return alert("Admin key not set. Click 'Set Admin Key'.");

    const file = document.getElementById("imageInput").files[0];
    if (file && file.size > 2 * 1024 * 1024) return alert("Image too large (max 2MB).");

    const payload = {
      name: document.getElementById("productName").value.trim(),
      description: document.getElementById("productDescription").value.trim(),
      category: document.getElementById("productCategory").value,
      price: Number(document.getElementById("productPrice").value),
      image: ""
    };

    if(!payload.name) return alert("Name is required");
    if(!payload.price) return alert("Price is required");

    if(file) payload.image = await fileToBase64(file);

    const btn = document.getElementById("addBtn");
    btn.disabled = true;
    btn.textContent = "Saving...";
    setAdminStatus("Saving coffee...");

    try{
      const res = await fetch(API_BASE + "/api/coffee", {
        method: "POST",
        headers: { "Content-Type":"application/json", "x-admin-key": key },
        body: JSON.stringify(payload)
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Failed to add item");

      alert("‚úÖ Coffee item added!");
      setAdminStatus("Saved ‚úÖ");
      formEl.reset();
      document.getElementById("imagePreview").classList.add("hidden");
      await loadProducts();
    }catch(e){
      setAdminStatus("Error: " + e.message, true);
      alert("Add error: " + e.message);
    }finally{
      btn.disabled = false;
      btn.textContent = "Add Item";
    }
  }

  function openEditProduct(id){
    const p = products.find(x => String(x._id) === String(id));
    if(!p) return alert("Item not found");

    document.getElementById("editMsg").textContent = "";
    document.getElementById("editId").value = p._id;
    document.getElementById("editName").value = p.name || "";
    document.getElementById("editPrice").value = Number(p.price) || 0;
    document.getElementById("editDescription").value = p.description || "";
    document.getElementById("editCategory").value = p.category || "beans";

    const prev = document.getElementById("editPreview");
    if(p.image){
      prev.src = p.image;
      prev.classList.remove("hidden");
    } else {
      prev.classList.add("hidden");
    }

    document.getElementById("editImage").value = "";
    document.getElementById("editModal").classList.remove("hidden");
  }

  function closeEditModal(){ document.getElementById("editModal").classList.add("hidden"); }

  async function saveEditProduct(){
    const key = getAdminKey();
    if(!key) return alert("Admin key not set. Click 'Set Admin Key'.");

    const id = document.getElementById("editId").value;
    const name = document.getElementById("editName").value.trim();
    const price = Number(document.getElementById("editPrice").value);
    const description = document.getElementById("editDescription").value.trim();
    const category = document.getElementById("editCategory").value;
    const file = document.getElementById("editImage").files[0];

    const msg = document.getElementById("editMsg");
    msg.textContent = "";

    if(!name) return msg.textContent = "Name is required";
    if(!price) return msg.textContent = "Price is required";
    if(file && file.size > 2 * 1024 * 1024) return msg.textContent = "Image too large (max 2MB)";

    const payload = { name, price, description, category };
    if(file) payload.image = await fileToBase64(file);

    try{
      const res = await fetch(API_BASE + "/api/coffee/" + encodeURIComponent(id), {
        method: "PUT",
        headers: { "Content-Type":"application/json", "x-admin-key": key },
        body: JSON.stringify(payload)
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Update failed");

      alert("‚úÖ Updated!");
      closeEditModal();
      await loadProducts();
    }catch(e){
      msg.textContent = e.message;
    }
  }

  async function deleteProduct(id){
    const key = getAdminKey();
    if(!key) return alert("Admin key not set. Click 'Set Admin Key'.");
    if(!confirm("Delete this item?")) return;

    try{
      const res = await fetch(API_BASE + "/api/coffee/" + encodeURIComponent(id), {
        method: "DELETE",
        headers: { "x-admin-key": key }
      });
      const { text, json } = await readJsonSafe(res);
      if(!res.ok) throw new Error(json?.details || json?.error || text || "Delete failed");
      alert("‚úÖ Deleted!");
      await loadProducts();
    }catch(e){
      alert("Delete error: " + e.message);
    }
  }

  // previews
  document.addEventListener("change", (e) => {
    if(e.target && e.target.id === "imageInput"){
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = document.getElementById("imagePreview");
        img.src = ev.target.result;
        img.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }

    if(e.target && e.target.id === "editImage"){
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = document.getElementById("editPreview");
        img.src = ev.target.result;
        img.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }
  });

  document.addEventListener("DOMContentLoaded", async () => {
    document.getElementById("yy").textContent = new Date().getFullYear();

    // If key exists, try auto-unlock
    const savedKey = getAdminKey();
    if(savedKey){
      try{
        const ok = await verifyAdminKey(savedKey);
        adminUnlocked = ok;
        if(!ok) clearAdminKey();
      }catch{
        adminUnlocked = false;
      }
    }

    document.getElementById("productForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      await addProduct(e.target);
    });

    updateCartCount();
    setAuthLabel();
    loadProducts();
  });
</script>
</body>
</html>
